{% extends 'base.html.twig' %}

{% block body %}

    {% include 'layout/menu.html.twig' %}

    <style>
        #semaine
        {
            font-size: 30px;
            padding-left: 150px;

        }

        #colonne1 {
            position: absolute;
            width: 60%;
            height: 60%;
            bottom:0;
            left:0;
            top: 0;
            right:0;
            margin: auto;
            margin-left: 50px;
            margin-bottom: 175px;
            zoom:125%;
        }

        #colonne2
        {
            position: absolute;
            width: 38%;
            height: 59.9%;
            bottom:0;
            top: 0;
            margin: auto;
            margin-left: 525px;
            margin-bottom: 175px;
            zoom:125%;
        }

        .separation2
        {
            clear: both;
            position: absolute;
            height: 800px;
            width: 3px;
            margin-left: 600px;
            margin-top: 50px;
            background:  #531B51;
        }

        .bouton1
        {
            width: 75px;
            height: 75px;
            background:#A73C97;
            font:bold 55px Montserrat;
            border-radius:50%;
            border:none;
            color:#fff;
        }

        #dont
        {
            color: #A73C97;
            font-size: 30px;
        }


        .separation
        {

            position: absolute;
            margin-left: 300px;
            height: 100%;
            width: 1px;
            background: grey;
            top: 0;
            bottom: 0;
            opacity: 0.2;
        }

        .form-error-message
        {
            color: red;
        }

        p
        {
            color: black;
        }
    </style>

    {% include 'layout/notification.html.twig' %}

    <center>
        <div class="container mt-1">
            <p style="color: #531B51;" id="semaine">{{ semaine }}</p>
            <div class="row ml-4">
                <div class="col" id="colonne1">
                    <h3 style="color: #531B51;"><b>NOMBRE DE MANDATS</b></h3>
                    <p class="nombre_mandat" style="font-size: 7em; color: #531B51;">{{ mandat ? mandat.nombre : 0 }}</p>
                    <p style="font-size: 2em; color: #531B51;">Mandats</p></br>
                    <button style="background-color: #531B51; border-radius: 12px;" class="btn btn-light" role="button" data-toggle="modal" data-target="#mandat"><span>Ajouter Mandats</span></button>
                </div>
            </div>
            <div>
                <hr class="separation2" />
            </div>
            <div id="colonne2" class="col">
                <center>
                    <h3 style="color: #531B51;"><b>NOMBRE DE VENTES</b></h3>
                    <p id="mesventes" style="font-size: 7em; color: #531B51;">{{ count_vente.vente }}</p>
                    <p style="font-size: 2em; color: #531B51;">Ventes</p>
                    <p id="dont">dont</p></br>
                    <div class="row pl-4">
                        <div class="col pl-2">
                            <button id="bouton1" class="bouton1">{{ count_livree.livree }}</button>
                            <span style="color: black;">Livraisons</span>
                        </div>
                        <div class="col">
                            <button id="bouton2" class="bouton1">{{ count_fraisMER.fraisMER }}</button></br>
                            <span style="color: black;">Frais de mise en service</span>
                        </div>
                        <div class="col pl-2">
                            <button id="bouton3" class="bouton1">{{ count_garantie.garantie }}</button>
                            <span style="color: black;">Garanties</span>
                        </div>
                        <div class="col pl-2">
                            <button id="bouton4" class="bouton1">{{ count_financement.financement }}</button>
                            <span style="color: black;">Financements</span>
                        </div>
                    </div></br>
                    <button style="background-color: #531B51; border-radius: 12px;" class="btn btn-light" role="button" data-toggle="modal" data-target="#vente"><span>Ajouter Ventes</span></button>
                </center>
            </div>
        </div>
    </center>

    <div class="modal fade" id="mandat" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" style="color: #531B51;">AJOUT DE MANDATS</h2></br>
                </div>
                <div class="modal-body">
                    <p style="font-size: 15px; color: #531B51;">Combien de mandats souhaitez-vous comptabiliser ?</p></br>
                    {{ form_start(form_mandat) }}
                    {{ form_row(form_mandat.nombre, {'attr': {'placeholder': 'Nombre'}}) }}
                </div>
                <div class="modal-footer">
                    <button rel="popuptrois" id="poplight3" style="background-color: #9D1458;" type="submit" class="btn btn-light" data-dismiss="modal"><span style="color: white;">Ajouter</span></button>
                    {{ form_end(form_mandat) }}
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="vente" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" style="color: #531B51;">AJOUT D'UNE VENTE</h2></br>
                </div>
                <div class="modal-body">
                    {{ form_start(form_vente) }}
                    {{ form_row(form_vente.date_vente, {'attr': {'placeholder': '01/01/1900'}}) }}
                    {{ form_row(form_vente.immatriculation, {'attr': {'placeholder': 'AA123BB'}}) }}
                    <div class="row">
                        <div class="col-sm">
                            {{ form_row(form_vente.livree) }}
                        </div>
                        <div class="col-sm">
                            {{ form_row(form_vente.frais_mer) }}
                        </div>
                        <div class="col-sm">
                            {{ form_row(form_vente.garantie) }}
                        </div>
                        <div class="col-sm">
                            {{ form_row(form_vente.financement) }}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="js-add" style="background-color: #9D1458;" type="submit" class="btn btn-light" data-dismiss="modal"><span style="color: white;">Ajouter</span></button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script type="text/javascript">

        $(document).ready(function() {

            $('#poplight3').click(function(e){
                e.preventDefault();

                var mandat = $('input[placeholder="Nombre"]').val();

                jQuery.ajax({
                    url: '{{ path('add-mandat') }}',
                    type: 'POST',
                    data: {
                        mandat: mandat
                    },
                    success: function (data) {
                        $('.nombre_mandat').html(data.response);

                        $('#fade , .popup_block').fadeOut(function() {
                            $('#fade, a.close').remove();  //...ils disparaissent ensemble
                        });
                        $('form').find('input').val("");

                        if(data.message === "Erreur dans l'ajout de mandat")
                        {
                            toastr.error(data.message)
                        }
                        else
                        {
                            toastr.success(data.message)
                        }


                    },
                    error: function (jqxhr) {
                        alert(jqxhr.responseText);
                    }
                });
            });

            $('#js-add').click(function(e){
                e.preventDefault();

                var date_vente = $('input[placeholder="01/01/1900"]').val();
                var immatriculation = $('input[placeholder="AA123BB"]').val();
                var livree = $('input[name="vente[livree]"]').attr("checked") ? 1 : 0;
                var fraisMER = $('input[name="vente[frais_mer]"]').attr("checked") ? 1 : 0;
                var garantie = $('input[name="vente[garantie]"]').attr("checked") ? 1 : 0;
                var financement = $('input[name="vente[financement]"]').attr("checked") ? 1 : 0;

                jQuery.ajax({
                    url: '{{ path('add-vente') }}',
                    type: 'POST',
                    data: {
                        vente: date_vente,
                        immatriculation: immatriculation,
                        livree: livree,
                        fraisMER: fraisMER,
                        garantie: garantie,
                        financement: financement
                    },
                    success: function (data) {

                        if(data.errors !== undefined)
                        {
                            for(const error in data.errors)
                            {
                                toastr.error(data.errors[error],{
                                    "closeButton": true,
                                    "debug": false,
                                    "newestOnTop": false,
                                    "progressBar": true,
                                    "positionClass": "toast-top-right",
                                    "preventDuplicates": false,
                                    "onclick": null,
                                    "showDuration": "300",
                                    "hideDuration": "1000",
                                    "timeOut": "7000",
                                    "extendedTimeOut": "1000",
                                    "showEasing": "swing",
                                    "hideEasing": "linear",
                                    "showMethod": "fadeIn",
                                    "hideMethod": "fadeOut"
                                });
                            }

                            $('#fade , .popup_block').fadeOut(function() {
                                $('#fade, a.close').remove();  //...ils disparaissent ensemble
                            });

                            $('input[placeholder="01/01/1900"]').val("")
                            $('input[placeholder="AA123BB"]').val("");
                            $('input[type="checkbox"]').attr('checked', false);
                        }
                        else
                        {
                            $('#mesventes').html(data.vente);
                            $('#bouton1').html(data.livree);
                            $('#bouton2').html(data.fraisMER);
                            $('#bouton3').html(data.garanties);
                            $('#bouton4').html(data.financement);

                            toastr.success(data.message)

                            $('#fade , .popup_block').fadeOut(function() {
                                $('#fade, a.close').remove();  //...ils disparaissent ensemble
                            });

                            $('input[placeholder="01/01/1900"]').val("")
                            $('input[placeholder="AA123BB"]').val("");
                            $('input[type="checkbox"]').attr('checked', false);




                        }

                    },
                    error: function (jqxhr) {
                        console.log(jqxhr.responseText);
                    }
                });


            });

        });

    </script>

{% endblock %}

































